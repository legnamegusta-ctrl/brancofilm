rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function signedIn() { return request.auth != null; }
    function isAdmin() {
      return get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    match /users/{uid} {
      allow read: if signedIn() && (uid == request.auth.uid || isAdmin());
      allow write: if isAdmin();
    }
    match /auditLogs/{id} {
      allow read: if signedIn();
      allow write: if false;
    }
    match /orders/{id} {
      allow read: if signedIn();
      allow write: if isAdmin();
    }
    match /quotes_public/{token} {
      allow read: if true;
      allow write: if false;
    }
    match /{document=**} {
      allow read, write: if signedIn();
    }
  }
}

// índices necessários:
// orders(scheduledStart asc)
// orders(status asc, createdAt desc)
// orders(status asc, kanbanOrder asc)
// orders(assignedTo asc, scheduledStart asc)
// orders(customerId asc, scheduledStart asc)
// orders(vehicleId asc, scheduledStart asc)
// quotes(status asc, createdAt desc)
// quotes_public(token asc)
// users(role asc)
// services(createdAt desc)
